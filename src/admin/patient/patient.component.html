<div class="container-fluid">
  <div class="container">
    <div class="page-header">
      <h1>üîç Air Quality Reports Lookup</h1>
      <p class="subtitle">Search for air quality reports by Station ID</p>
    </div>
    
    <div *ngIf="searchCompleted" style="background: #fff3cd; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
      <button 
        class="btn btn-approve" 
        style="margin-top: 0.5rem; font-size: 0.85rem; padding: 0.4rem 1rem;"
        (click)="fundContract()">
        üí∞ Fund Contract with ETH
      </button>
      <div *ngIf="contractBalance !== null" class="contract-balance-info">
        üí∞ Contract Balance: <strong>{{ contractBalance }} ETH</strong>
      </div>
    </div>

    <!-- Search Box -->
    <div class="search-section">
      <div class="search-card">
        <div class="search-header">
          <i class="fas fa-search"></i>
          <h3>Search Station Reports</h3>
        </div>
        <div class="search-body">
          <form (ngSubmit)="searchReports()" #searchForm="ngForm">
            <div class="search-input-group">
              <label for="stationId" class="form-label">Station ID (Wallet Address)</label>
              <div class="input-with-button">
                <input 
                  type="text" 
                  class="form-control search-input" 
                  id="stationId"
                  [(ngModel)]="searchStationId" 
                  name="stationId"
                  placeholder="Enter station wallet address (0x...)"
                  required
                  [disabled]="isLoading">
                <button 
                  type="submit" 
                  class="btn btn-search" 
                  [disabled]="!searchForm.valid || isLoading">
                  <span *ngIf="!isLoading">
                    <i class="fas fa-search"></i> Search
                  </span>
                  <span *ngIf="isLoading">
                    <span class="spinner-border spinner-border-sm me-2"></span>
                    Searching...
                  </span>
                </button>
              </div>
              <small class="form-text">
                Example: 0x1234567890abcdef1234567890abcdef12345678
              </small>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Station Information (if found) -->
    <div *ngIf="stationInfo && !isLoading" class="station-info-card">
      <div class="station-header">
        <div class="station-image">
          <img 
            [src]="stationInfo.imageHash || '../../../assets/images/portrait.png'" 
            alt="Station Image"
            class="station-avatar">
        </div>
        <div class="station-details">
          <h4>{{ stationInfo.fName }} {{ stationInfo.lName }}</h4>
          <p class="station-id">
            <i class="fas fa-id-card"></i> 
            Station ID: <span class="id-text">{{ stationInfo.docID }}</span>
          </p>
          <div class="station-meta">
            <span class="meta-item">
              <i class="fas fa-map-marker-alt"></i>
              {{ stationInfo.city }}, {{ stationInfo.state }}
            </span>
            <span class="meta-item">
              <i class="fas fa-tag"></i>
              {{ stationInfo.speciality }}
            </span>
            <span class="meta-item">
              <i class="fas fa-calendar"></i>
              Joined: {{ stationInfo.Doj }}
            </span>
          </div>
          <div class="station-contact">
            <span class="contact-item">
              <i class="fas fa-envelope"></i>
              {{ stationInfo.emailID }}
            </span>
            <span class="contact-item">
              <i class="fas fa-phone"></i>
              {{ stationInfo.phone }}
            </span>
          </div>
        </div>
      </div>
      <div class="reports-count">
        <i class="fas fa-file-alt"></i>
        <span class="count-number">{{ reports.length }}</span>
        <span class="count-label">Total Reports Found</span>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner-large"></div>
      <p>Loading reports...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !isLoading" class="error-state">
      <div class="error-icon">‚ö†Ô∏è</div>
      <h3>{{ errorMessage }}</h3>
      <p>Please check the Station ID and try again.</p>
      <button class="btn btn-retry" (click)="clearSearch()">
        <i class="fas fa-redo"></i> Try Again
      </button>
    </div>

    <!-- No Reports State -->
    <div *ngIf="!isLoading && !errorMessage && searchCompleted && reports.length === 0 && stationInfo" class="empty-reports-state">
      <div class="empty-icon">üì≠</div>
      <h3>No Reports Found</h3>
      <p>This station hasn't submitted any air quality reports yet.</p>
    </div>

    <!-- Reports Grid -->
    <div *ngIf="!isLoading && !errorMessage && reports.length > 0" class="reports-section">
      <div class="reports-header">
        <h2>Air Quality Reports</h2>
        <div class="reports-actions">
          <button class="btn btn-refresh" (click)="refreshReports()">
            <i class="fas fa-sync-alt"></i> Refresh
          </button>
          <span class="reports-count-badge">{{ reports.length }} Reports</span>
        </div>
      </div>

      <div class="reports-grid">
        <div class="report-card" *ngFor="let report of reports; let i = index">
          <!-- Card Header -->
          <div class="card-header">
            <div class="header-info">
              <h3>{{ report.location }}</h3>
              <p class="timestamp">{{ formatDate(report.timestamp) }}</p>
            </div>
            <div class="aqi-badge" [style.background-color]="getAQIColor(report.aqi)">
              <span class="aqi-label">AQI</span>
              <span class="aqi-value">{{ report.aqi }}</span>
            </div>
          </div>

          <!-- Approval Status & Button -->
          <div class="approval-section">
            <div class="status-badge" [ngClass]="{'approved': report.approved, 'pending': !report.approved}">
              <i class="fas" [ngClass]="report.approved ? 'fa-check-circle' : 'fa-clock'"></i>
              {{ report.approved ? 'Approved' : 'Pending Approval' }}
            </div>
            <button 
              *ngIf="!report.approved"
              class="btn btn-approve"
              (click)="approveReport(i)"
              [disabled]="approvingReportIndex === i">
              <span *ngIf="approvingReportIndex !== i">
                <i class="fas fa-check"></i> Approve & Reward (1 ETH)
              </span>
              <span *ngIf="approvingReportIndex === i">
                <span class="spinner-border spinner-border-sm me-2"></span>
                Approving...
              </span>
            </button>
          </div>

          <!-- Main Pollutants -->
          <div class="pollutants-section">
            <h4>Particulate Matter</h4>
            <div class="pollutant-grid">
              <div class="pollutant-item">
                <span class="pollutant-label">PM2.5</span>
                <span class="pollutant-value">{{ report.pm25 }} <small>¬µg/m¬≥</small></span>
              </div>
              <div class="pollutant-item">
                <span class="pollutant-label">PM10</span>
                <span class="pollutant-value">{{ report.pm10 }} <small>¬µg/m¬≥</small></span>
              </div>
            </div>
          </div>

          <!-- Gas Pollutants -->
          <div class="pollutants-section">
            <h4>Gaseous Pollutants</h4>
            <div class="pollutant-grid">
              <div class="pollutant-item">
                <span class="pollutant-label">CO‚ÇÇ</span>
                <span class="pollutant-value">{{ report.co2 }} <small>ppm</small></span>
              </div>
              <div class="pollutant-item">
                <span class="pollutant-label">NO‚ÇÇ</span>
                <span class="pollutant-value">{{ report.no2 }} <small>ppb</small></span>
              </div>
              <div class="pollutant-item">
                <span class="pollutant-label">SO‚ÇÇ</span>
                <span class="pollutant-value">{{ report.so2 }} <small>ppb</small></span>
              </div>
              <div class="pollutant-item">
                <span class="pollutant-label">O‚ÇÉ</span>
                <span class="pollutant-value">{{ report.o3 }} <small>ppb</small></span>
              </div>
            </div>
          </div>

          <!-- Environmental Conditions -->
          <div class="pollutants-section">
            <h4>Environmental Conditions</h4>
            <div class="pollutant-grid">
              <div class="pollutant-item">
                <span class="pollutant-label">üå°Ô∏è Temperature</span>
                <span class="pollutant-value">{{ report.temperature }}¬∞C</span>
              </div>
              <div class="pollutant-item">
                <span class="pollutant-label">üíß Humidity</span>
                <span class="pollutant-value">{{ report.humidity }}%</span>
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div *ngIf="report.notes" class="notes-section">
            <h4>Notes</h4>
            <p>{{ report.notes }}</p>
          </div>

          <!-- Footer -->
          <div class="card-footer">
            <small class="report-id">Report ID: {{ report.reportId }}</small>
            <small class="ipfs-hash" *ngIf="report.ipfsHash" [title]="report.ipfsHash">
              üìé IPFS: {{ report.ipfsHash.substring(0, 15) }}...
            </small>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>